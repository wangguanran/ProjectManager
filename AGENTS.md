# ProjectManager Agent Guide

You are working in the `ProjectManager` repository.

## Priorities

1. Treat `docs/test_cases_en.md` as the source of truth for expected behavior.
2. Keep changes minimal and tightly scoped.
3. Prefer reproducible steps with exact commands and file paths.
4. After each module-level change (or after verifying a test suite passes), make a small commit and push it.
5. Before each commit, run `make format` (black + isort).
6. After each push, confirm GitHub Actions is green for the pushed commit SHA.
7. Track work in the repo-root TODO note and delete completed TODO items:
   - `./TODO.md`

## Local Dev Commands

- Setup (recommended):
  - `REPO_ROOT="$(git rev-parse --show-toplevel)" && cd "$REPO_ROOT"`
  - `python3 -m venv /tmp/pm-venv`
  - `/tmp/pm-venv/bin/python -m pip install -U pip`
  - `/tmp/pm-venv/bin/python -m pip install -e '.[dev]'`
  - `/tmp/pm-venv/bin/projman --version`
- Tests:
  - `cd "$(git rev-parse --show-toplevel)" && /tmp/pm-venv/bin/python -m pytest`
- Lint/format:
  - `cd "$(git rev-parse --show-toplevel)" && PATH="/tmp/pm-venv/bin:$PATH" make lint`
  - `cd "$(git rev-parse --show-toplevel)" && PATH="/tmp/pm-venv/bin:$PATH" make format`
- Install/Update projman (standalone binary):
  - `cd "$(git rev-parse --show-toplevel)" && PATH="/tmp/pm-venv/bin:$PATH" ./build.sh`
  - `cd "$(git rev-parse --show-toplevel)" && ./install.sh`
- GitHub Actions check (no token required for public repo):
  - `cd "$(git rev-parse --show-toplevel)" && SHA="$(git rev-parse HEAD)" && curl -sS -H "Accept: application/vnd.github+json" "https://api.github.com/repos/wangguanran/ProjectManager/actions/runs?per_page=30&branch=master" | SHA="$SHA" python3 -c 'import os,sys,json; sha=os.environ["SHA"]; data=json.load(sys.stdin); runs=[r for r in data.get("workflow_runs",[]) if r.get("head_sha")==sha]; print([(r.get("name"),r.get("status"),r.get("conclusion")) for r in runs])'`

## Safety Rules

- For destructive project operations (`po_apply`, `po_revert`, `project_diff`), prefer running with `--dry-run` first when operating on real repositories.
- Avoid destructive git commands (for example `git reset --hard`) unless explicitly requested.
- Never paste or commit secrets (tokens/passwords). Prefer `gh auth login` or public GitHub APIs where possible.

## Version/Build Rule

- `--version` must include a short git commit hash when available (for build artifacts this must not depend on a runtime `.git` directory).
- Build metadata is generated by `scripts/write_build_info.py` (used by `build.sh` and CI workflows).
