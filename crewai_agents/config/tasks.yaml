# Task 配置文件
# ProjectManager CrewAI Tasks

analyze_requirements:
  description: |
    用户需求: {requirements}
    
    你的任务:
    1. 与用户对话，明确和细化需求
    2. 分析需求的完整性、一致性和可测试性
    3. 生成详细的测试用例，包括:
       - 测试场景描述
       - 前置条件
       - 测试步骤
       - 预期结果
       - 优先级
    4. 检查是否与现有需求冲突
    5. 更新 docs/test_cases_zh.md 文件
    
    注意:
    - 如果发现需求冲突，必须提醒用户并等待确认
    - 测试用例要覆盖正常流程、边界条件和异常场景
    - 保持测试用例的独立性和可重复性
  expected_output: "清晰的需求规格文档和完整的测试用例列表"
  agent: requirement_analyst_agent

design_and_decompose:
  description: |
    你的任务:
    1. 接收并理解需求分析结果
    2. 设计实现方案，考虑:
       - 代码结构
       - 模块划分
       - 接口设计
       - 依赖关系
    3. 将需求分解为具体的开发任务
    4. 创建/更新 docs/tasks.md，记录:
       - 任务列表
       - 任务描述
       - 优先级
       - 依赖关系
       - 负责人
    5. 将任务分配给编码 Agent
    
    任务格式:
    ## 任务列表
    
    ### 任务 ID: TASK-001
    - **标题**: 任务标题
    - **描述**: 详细描述
    - **状态**: pending | in_progress | review | testing | done
    - **优先级**: high | medium | low
    - **负责人**: Agent 类型
    - **依赖**: 其他任务 ID
    - **创建时间**: ISO 格式时间
  expected_output: "任务分解文档 (tasks.md)"
  agent: architect_agent

coding:
  description: |
    你的任务:
    1. 从架构师接收具体任务
    2. 严格按照任务要求编写代码
    3. 确保代码质量:
       - 遵循 PEP 8 规范
       - 添加适当的注释
       - 使用类型提示
       - 错误处理完善
    4. 只能修改与任务相关的代码
    5. 完成後提交给 Review Agent
    
    重要:
    - 不要添加任务未要求的功能
    - 不要修改无关代码
    - 保持代码简洁
  expected_output: "符合规范的代码实现"
  agent: coder_agent

code_review:
  description: |
    你的任务:
    1. 接收编码 Agent 提交的代码
    2. 全面审核代码，包括:
       - 代码规范 (pylint, black)
       - 逻辑正确性
       - 安全性
       - 性能
       - 可维护性
    3. 检查是否满足任务要求
    4. 给出审核结果:
       - 通过: 交给测试 Agent
       - 不通过: 退回给编码 Agent 继续修改
    
    审核标准:
    - pylint 分数 >= 10/10
    - 所有测试通过
    - 代码覆盖率不降低
  expected_output: "审核通过或需要修改的反馈"
  agent: review_agent

write_test_cases:
  description: |
    你的任务:
    1. 接收需求和实现细节
    2. 根据功能编写测试用例
    3. 使用 pytest 框架
    4. 测试类型包括:
       - 单元测试
       - 集成测试
       - 边界测试
       - 异常测试
    5. 确保测试覆盖率
    6. 将测试用例交给执行 Agent
    
    注意事项:
    - 测试文件放在 tests/ 目录
    - 测试方法以 test_ 开头
    - 使用 pytest fixtures
  expected_output: "完整的测试用例文件"
  agent: test_agent

execute_and_verify:
  description: |
    你的任务:
    1. 接收测试 Agent 编写的测试用例
    2. 运行测试套件
    3. 分析测试结果:
       - 通过的测试
       - 失败的测试
       - 覆盖率报告
    4. 判断测试用例是否完备:
       - 是否覆盖所有场景
       - 是否覆盖边界条件
       - 是否覆盖异常情况
    5. 如果不完备: 退回给测试 Agent 继续修改
    6. 如果通过:
       - 反馈给架构师
       - 更新 tasks.md 中的任务状态
       - 生成 commit message
       - 推送到服务器
    
    Commit Message 格式:
    <type>(<scope>): <subject>
    
    Types:
    - feat: 新功能
    - fix: 修复 bug
    - docs: 文档更新
    - style: 代码格式
    - refactor: 重构
    - test: 测试相关
    - chore: 其他
    
    Example:
    feat(board): 添加主板创建功能
    
    close #123
  expected_output: "测试结果报告和代码提交"
  agent: executor_agent
